!function(n,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("jotai/vanilla")):"function"==typeof define&&define.amd?define(["exports","jotai/vanilla"],e):e((n||self).jotaiEffect={},n.vanilla)}(this,function(n,e){function r(n){if(null!==n.pendingError){var e=n.pendingError;throw n.pendingError=null,e}}n.atomEffect=function(n){var i=e.atom(function(){return{mounted:!1,inProgress:0,promise:void 0,cleanup:void 0,fromCleanup:!1,recursing:!1,refresh:function(){},refreshing:!1,get:function(){},set:function(){},pendingError:null}}),o=e.atom(0),t=e.atom(null,function(n,e,t){var u=n(i);u.mounted=t,t?(u.get=n,u.set=e,u.refresh=function(){try{u.refreshing=!0,e(o,function(n){return n+1})}finally{u.refreshing=!1}},e(o,function(n){return n+1})):(r(u),null==u.cleanup||u.cleanup(),u.cleanup=void 0)});t.onMount=function(n){return n(!0),function(){n(!1)}};var u=e.atom(function(e){e(o);var t=e(i);if(!t.mounted)return t.promise;if(t.recursing)return t.promise;if(t.inProgress&&!t.refreshing)return t.promise;r(t);var u=new Map,f=function(n){var r=e(n);return u.set(n,r),r};f.peek=function(n){return t.get(n)};var a=function(){try{return++t.inProgress,t.set.apply(t,[].slice.call(arguments))}finally{--t.inProgress}};a.recurse=function(n){if(t.fromCleanup)"production"!==process.env.NODE_ENV&&console.warn("cannot recurse inside cleanup");else try{return t.recursing=!0,t.set.apply(t,[n].concat([].slice.call(arguments,1)))}finally{t.recursing=!1,Array.from(u).some(function(n){var r=n[1];return e(n[0])!==r})&&t.refresh()}},++t.inProgress;var s=function(){try{if(t.refreshing=!1,!t.mounted)return;try{t.fromCleanup=!0,null==t.cleanup||t.cleanup()}finally{t.fromCleanup=!1}t.cleanup=n(f,a)}catch(n){t.pendingError=n,t.refresh()}finally{t.promise=void 0,--t.inProgress}};return t.refreshing?s():t.promise=Promise.resolve().then(s)});return"production"!==process.env.NODE_ENV&&(i.debugPrivate=!0,o.debugPrivate=!0,t.debugPrivate=!0,u.debugPrivate=!0),e.atom(function(n){n(t),n(u)})}});
//# sourceMappingURL=index.umd.js.map
